"use strict";var tt=Object.defineProperty;var et=(t,e,n)=>e in t?tt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var $=(t,e,n)=>(et(t,typeof e!="symbol"?e+"":e,n),n);const c=require("obsidian");function g(){}function q(t){return t()}function B(){return Object.create(null)}function M(t){t.forEach(q)}function G(t){return typeof t=="function"}function J(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function nt(t){return Object.keys(t).length===0}function X(t,...e){if(t==null){for(const s of e)s(void 0);return g}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function st(t){let e;return X(t,n=>e=n)(),e}function N(t,e,n){t.$$.on_destroy.push(X(e,n))}function at(t,e,n){t.insertBefore(e,n||null)}function Y(t){t.parentNode&&t.parentNode.removeChild(t)}function it(t){return document.createElement(t)}function rt(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function lt(t){return Array.from(t.childNodes)}let E;function v(t){E=t}function ot(){if(!E)throw new Error("Function called outside component initialization");return E}function ct(t){ot().$$.on_mount.push(t)}const _=[],F=[];let b=[];const R=[],ut=Promise.resolve();let O=!1;function dt(){O||(O=!0,ut.then(H))}function A(t){b.push(t)}const I=new Set;let w=0;function H(){if(w!==0)return;const t=E;do{try{for(;w<_.length;){const e=_[w];w++,v(e),ht(e.$$)}}catch(e){throw _.length=0,w=0,e}for(v(null),_.length=0,w=0;F.length;)F.pop()();for(let e=0;e<b.length;e+=1){const n=b[e];I.has(n)||(I.add(n),n())}b.length=0}while(_.length);for(;R.length;)R.pop()();O=!1,I.clear(),v(t)}function ht(t){if(t.fragment!==null){t.update(),M(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}function pt(t){const e=[],n=[];b.forEach(s=>t.indexOf(s)===-1?e.push(s):n.push(s)),n.forEach(s=>s()),b=e}const gt=new Set;function ft(t,e){t&&t.i&&(gt.delete(t),t.i(e))}function mt(t,e,n){const{fragment:s,after_update:a}=t.$$;s&&s.m(e,n),A(()=>{const i=t.$$.on_mount.map(q).filter(G);t.$$.on_destroy?t.$$.on_destroy.push(...i):M(i),t.$$.on_mount=[]}),a.forEach(A)}function wt(t,e){const n=t.$$;n.fragment!==null&&(pt(n.after_update),M(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function yt(t,e){t.$$.dirty[0]===-1&&(_.push(t),dt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function _t(t,e,n,s,a,i,o=null,d=[-1]){const u=E;v(t);const l=t.$$={fragment:null,ctx:[],props:i,update:g,not_equal:a,bound:B(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:B(),dirty:d,skip_bound:!1,root:e.target||u.$$.root};o&&o(l.root);let x=!1;if(l.ctx=n?n(t,e.props||{},(r,h,...p)=>{const f=p.length?p[0]:h;return l.ctx&&a(l.ctx[r],l.ctx[r]=f)&&(!l.skip_bound&&l.bound[r]&&l.bound[r](f),x&&yt(t,r)),h}):[],l.update(),x=!0,M(l.before_update),l.fragment=s?s(l.ctx):!1,e.target){if(e.hydrate){const r=lt(e.target);l.fragment&&l.fragment.l(r),r.forEach(Y)}else l.fragment&&l.fragment.c();e.intro&&ft(t.$$.fragment),mt(t,e.target,e.anchor),H()}v(u)}class bt{constructor(){$(this,"$$");$(this,"$$set")}$destroy(){wt(this,1),this.$destroy=g}$on(e,n){if(!G(n))return g;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const a=s.indexOf(n);a!==-1&&s.splice(a,1)}}$set(e){this.$$set&&!nt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const St="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(St);const y=[];function K(t,e=g){let n;const s=new Set;function a(d){if(J(t,d)&&(t=d,n)){const u=!y.length;for(const l of s)l[1](),y.push(l,t);if(u){for(let l=0;l<y.length;l+=2)y[l][0](y[l+1]);y.length=0}}}function i(d){a(d(t))}function o(d,u=g){const l=[d,u];return s.add(l),s.size===1&&(n=e(a,i)||g),d(t),()=>{s.delete(l),s.size===0&&n&&(n(),n=null)}}return{set:a,update:i,subscribe:o}}const Q={defaultPanel:"",alwaysUseDefaultPanel:!1,tagMaps:[],folderMaps:[],blockList:[]},T=K(),C=K(Q);function vt(t){let e;return{c(){e=it("div"),rt(e,"class","break-words")},m(n,s){at(n,e,s),t[3](e)},p:g,i:g,o:g,d(n){n&&Y(e),t[3](null)}}}function Et(t,e,n){let s,a;N(t,T,r=>n(4,s=r)),N(t,C,r=>n(5,a=r));let i,{app:o}=e,{parent:d}=e;async function u(r,h){r=r.startsWith("[[")?r.substring(2,r.length-2):r;let p=o.metadataCache.getFirstLinkpathDest(r,h);return!p||!(p instanceof c.TFile)?"":await o.vault.cachedRead(p)}async function l(r){if(!r||!i)return;i&&i.empty();let h=o.metadataCache.getFileCache(r);if(!a.blockList.some(p=>r.basename===p)&&h){const p=c.getAllTags(h)||[];let f=[];a.defaultPanel!==""&&(a.alwaysUseDefaultPanel||!(h.frontmatter&&h.frontmatter["sidecar-panel"]))&&f.push(await u(a.defaultPanel,"/"));for(const{folder:S,panel:D}of a.folderMaps){const P=c.normalizePath(S);c.normalizePath(r.path).startsWith(P)&&f.push(await u(D,"/"))}for(const{tag:S,panel:D}of a.tagMaps){const P=S.startsWith("#")?S.slice(1):S;for(const k of p){const j=k.startsWith("#")?k.slice(1):k;(j==P||j.startsWith(`${P}/`))&&f.push(await u(D,"/"))}}h.frontmatter&&h.frontmatter["sidecar-panel"]&&f.push(await u(h.frontmatter["sidecar-panel"],"/")),await c.MarkdownRenderer.render(o,f.join(`
`),i,r.path,d)}}ct(()=>{T.subscribe(l),C.subscribe(()=>{l(s)})});function x(r){F[r?"unshift":"push"](()=>{i=r,n(0,i)})}return t.$$set=r=>{"app"in r&&n(1,o=r.app),"parent"in r&&n(2,d=r.parent)},[i,o,d,x]}let xt=class extends bt{constructor(e){super(),_t(this,e,Et,vt,J,{app:1,parent:2})}};const m="contextual-sidecar";class Pt extends c.ItemView{constructor(){super(...arguments),this.icon="container",this.navigation=!0}getViewType(){return m}getDisplayText(){return"Sidecar Panel View"}async onOpen(){this.component=new xt({target:this.contentEl,props:{app:this.app,parent:this}})}async onClose(){this.component.$destroy()}}var L=Object.defineProperty,kt=Object.getOwnPropertyDescriptor,Tt=Object.getOwnPropertyNames,Ct=Object.prototype.hasOwnProperty,Mt=(t,e)=>{for(var n in e)L(t,n,{get:e[n],enumerable:!0})},Dt=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Tt(e))!Ct.call(t,a)&&a!==n&&L(t,a,{get:()=>e[a],enumerable:!(s=kt(e,a))||s.enumerable});return t},$t=t=>Dt(L({},"__esModule",{value:!0}),t),Z={};Mt(Z,{FileInputSuggest:()=>Ft,FolderInputSuggest:()=>Vt,FuzzyInputSuggest:()=>z,setNodeIcon:()=>Lt});var It=$t(Z),V=c,z=class extends V.AbstractInputSuggest{constructor(t,e,n){super(t,e.inputEl),this.items=n}getSuggestions(t){let e=(0,V.prepareSimpleSearch)(t),n=[];for(let s of this.items){let a=e(this.getItemText(s));a&&n.push({item:s,match:a})}return n}renderSuggestion(t,e){var i;e.addClass("mod-complex");let n=e.createDiv({cls:"suggestion-content"});if(!(t!=null&&t.item)){n.setText("No match found"),(i=n.parentElement)==null||i.addClass("is-selected");return}let s=n.createDiv("suggestion-title");this.renderTitle(s,t);let a=n.createDiv("suggestion-note");this.renderNote(a,t)}renderMatches(t,e,n,s){(0,V.renderMatches)(t,e,n,s)}},U=c,Vt=class extends z{getItemText(t){return t.path}renderNote(t,e){let{item:n,match:s}=e;(0,U.renderMatches)(t,n.path,s.matches)}renderTitle(t,e){let{item:n,match:s}=e;(0,U.renderMatches)(t,n.name,s.matches,n.path.length-n.name.length)}},W=c,Ft=class extends z{getItemText(t){return t.path}renderNote(t,e){let{item:n,match:s}=e;(0,W.renderMatches)(t,n.path,s.matches)}renderTitle(t,e){let{item:n,match:s}=e;(0,W.renderMatches)(t,n.name,s.matches,n.path.length-n.name.length)}},Ot=c,At={"has-node-icon":"helpers_has-node-icon","x-small":"helpers_x-small",small:"helpers_small",medium:"helpers_medium",large:"helpers_large","x-large":"helpers_x-large"};function Lt(t,e){t.addClass(At["has-node-icon"]),(0,Ot.setIcon)(t,e)}class zt extends c.Plugin{async loadSettings(){this.settings=Object.assign({},Q,await this.loadData())}async saveSettings(){C.set(this.settings),await this.saveData(this.settings)}async onload(){await this.loadSettings(),this.settings.folderMaps===void 0&&(this.settings.folderMaps=[],this.saveSettings()),this.settings.tagMaps===void 0&&(this.settings.tagMaps=[],this.saveSettings()),C.set(this.settings),this.registerView(m,e=>new Pt(e)),this.registerEvent(this.app.workspace.on("file-open",e=>{e!==null&&T.set(e)})),this.addCommand({id:"activate-panel",name:"Activate Panel",callback:()=>this.activateView()}),this.addSettingTab(new jt(this.app,this)),this.app.workspace.onLayoutReady(async()=>{this.app.workspace.getLeavesOfType(m).length>0||await this.app.workspace.getRightLeaf(!1).setViewState({type:m})})}async activateView(){this.app.workspace.getLeavesOfType(m).length>0&&await this.app.workspace.getRightLeaf(!1).setViewState({type:m,active:!0}),this.app.workspace.revealLeaf(this.app.workspace.getLeavesOfType(m)[0])}async getCurrentFile(){return st(T)}}class jt extends c.PluginSettingTab{constructor(e,n){super(e,n),this.plugin=n}display(){let{containerEl:e}=this;e.empty(),new c.Setting(this.containerEl).setName("Default Panel").setDesc("Specify a default sidebar panel file, if none is set in the frontmatter.").addSearch(n=>{n.setPlaceholder("Example: daily-note-panel").setValue(this.plugin.settings.defaultPanel).onChange(async s=>{this.plugin.settings.defaultPanel=s,await this.plugin.saveSettings()})}),new c.Setting(this.containerEl).setName("Always use default panel?").setDesc("If checked, the default panel will be used for all files, even if one is specified in the frontmatter.").addToggle(n=>{n.setValue(this.plugin.settings.alwaysUseDefaultPanel).onChange(async s=>{this.plugin.settings.alwaysUseDefaultPanel=s,await this.plugin.saveSettings()})}),new c.Setting(this.containerEl).setDesc("Specify a sidecar panel for all files within a given folder.  These will be applied in order, before tag mappings."),new c.Setting(this.containerEl).setDesc("Add new folder map").addButton(n=>{n.setTooltip("Add another folder to map to a panel").setButtonText("+").setCta().onClick(async()=>{this.plugin.settings.folderMaps.push({folder:"",panel:""}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.folderMaps.forEach(({folder:n,panel:s},a)=>{e.createEl("div"),new c.Setting(this.containerEl).addSearch(i=>{const o=this.app.vault.getAllLoadedFiles().filter(u=>u instanceof c.TFolder),d=new It.FolderInputSuggest(this.app,i,o);d.onSelect(({item:u})=>{i.setValue(u.path),i.inputEl.trigger("input"),d.close()}),i.setPlaceholder("Example: /templates/").setValue(n).onChange(async u=>{if(u&&this.plugin.settings.folderMaps.some(l=>l.folder==u)){console.error("ForceViewMode: This folder is already associated with a panel: ",u);return}this.plugin.settings.folderMaps[a].folder=u,await this.plugin.saveSettings()})}).addSearch(i=>{i.setPlaceholder("Example: template-panel").setValue(s).onChange(async o=>{this.plugin.settings.folderMaps[a].panel=o,await this.plugin.saveSettings()})}).addExtraButton(i=>{i.setIcon("cross").setTooltip("Delete").onClick(async()=>{this.plugin.settings.folderMaps.splice(a,1),await this.plugin.saveSettings(),this.display()})})}),new c.Setting(this.containerEl).setDesc("Specify a sidecar panel for all files with a given tag.  These will be applied in order."),new c.Setting(this.containerEl).setDesc("Add new tag map").addButton(n=>{n.setTooltip("Add another tag to map to a panel").setButtonText("+").setCta().onClick(async()=>{this.plugin.settings.tagMaps.push({tag:"",panel:""}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.tagMaps.forEach(({tag:n,panel:s},a)=>{e.createEl("div"),new c.Setting(this.containerEl).addSearch(i=>{i.setPlaceholder("Example: #daily-note").setValue(n).onChange(async o=>{if(o&&this.plugin.settings.tagMaps.some(d=>d.tag==o)){console.error("ForceViewMode: This tag is already associated with a panel: ",o);return}this.plugin.settings.tagMaps[a].tag=o,await this.plugin.saveSettings()})}).addSearch(i=>{i.setPlaceholder("Example: daily-note-panel").setValue(s).onChange(async o=>{if(o&&this.plugin.settings.tagMaps.some(d=>d.tag==o)){console.error("ForceViewMode: This tag already has a panel associated with",o);return}this.plugin.settings.tagMaps[a].panel=o,await this.plugin.saveSettings()})}).addExtraButton(i=>{i.setIcon("cross").setTooltip("Delete").onClick(async()=>{this.plugin.settings.tagMaps.splice(a,1),await this.plugin.saveSettings(),this.display()})})}),new c.Setting(this.containerEl).setDesc("Deactivate sidecar for specific files."),new c.Setting(this.containerEl).setDesc("Add new blocked file").addButton(n=>{n.setTooltip("Add another file to the list of those that will not activate a sidecar.  All files with this name, regardless of folder, will be blocked.").setButtonText("+").setCta().onClick(async()=>{this.plugin.settings.blockList.push([]),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.blockList.forEach((n,s)=>{e.createEl("div"),new c.Setting(this.containerEl).addSearch(a=>{a.setPlaceholder("Example: a-special-note").setValue(n).onChange(async i=>{this.plugin.settings.blockList[s]=i,await this.plugin.saveSettings()})}).addExtraButton(a=>{a.setIcon("cross").setTooltip("Delete").onClick(async()=>{this.plugin.settings.blockList.splice(s,1),await this.plugin.saveSettings(),this.display()})})})}}module.exports=zt;


/* nosourcemap */